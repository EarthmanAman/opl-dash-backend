"use strict";(self.webpackChunkopl_frontend=self.webpackChunkopl_frontend||[]).push([[724],{724:function(e,t,r){r.r(t),r.d(t,{default:function(){return U}});var s=r(5861),n=r(5671),i=r(3144),a=r(136),o=r(5716),c=r(7757),u=r.n(c),l=r(2791),d=r(6168),m=r(9743),h=r(2677),p=r(717),_=r(4292),f=r(3360),v=r(6871),x=r(4475),y=r(4650),j=r(2591),C=r(184),Z=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,n.Z)(this,r);for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).state={info:[]},e.total=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!0===t?e.reduce((function(e,t){return e+t.count}),0):e.reduce((function(e,t){return e+t.sum}),0)},e}return(0,i.Z)(r,[{key:"numberWithCommas",value:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}},{key:"render",value:function(){return(0,C.jsxs)("div",{className:"customer-content__header",children:[(0,C.jsx)("h5",{className:"customer-content__header__name",children:this.props.name}),(0,C.jsx)("div",{className:"customer-info",children:(0,C.jsxs)(j.Z,{striped:!0,bordered:!0,hover:!0,size:"sm",children:[(0,C.jsx)("thead",{children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{children:"Total Sales"}),(0,C.jsx)("th",{children:"Total Amount"})]})}),(0,C.jsx)("tbody",{children:void 0===this.state.info?(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:"0"}),(0,C.jsx)("td",{children:"0"})]}):(0,C.jsxs)("tr",{children:[(0,C.jsx)("td",{children:this.total(this.state.info.months,!0)}),(0,C.jsx)("td",{children:this.numberWithCommas(this.total(this.state.info.months))})]})})]})})]})}}]),r}(l.Component);Z.getDerivedStateFromProps=function(e,t){var r=e.customer.filter((function(t){return t.year===parseInt(e.customer_year)}));return t.info=r[0],t};var b=(0,d.$j)((function(e){return{}}),{})(Z),S=r(9600),T=r(3496),g=r(3847),A=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var s;return(0,n.Z)(this,r),(s=t.call(this,e)).state={series:[],options:{chart:{type:"bar",height:350},title:{text:"Monthly Sale Comparison"},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{title:{text:"Months"},categories:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"]},yaxis:{title:{text:s.props.dashboard_metric?"Kshs (Millions)":"Litres"}},fill:{opacity:1},tooltip:{y:{formatter:s.props.dashboard_metric?function(e){return"Kshs "+e+" Million"}:function(e){return e+" Litres"}}}}},s}return(0,i.Z)(r,[{key:"render",value:function(){return(0,C.jsx)("div",{id:"chart",children:(0,C.jsx)(T.Z,{options:this.state.options,series:this.state.series,type:"bar",height:350})})}}]),r}(l.Component);A.getDerivedStateFromProps=function(e,t){var r=void 0!==e.customer?function(e,t,r){if(void 0===e||null===e||e===[])return null;var s=e.filter((function(e){return e.year===parseInt(t)})),n=new Array(12).fill(0);for(var i in e=s.length>0?s[0].months:[]){var a=e[i];n[a.date__month-1]="Million"===r?(0,g.$G)(a.sum/1e7):(0,g.$G)(a.sum/1e3)}return n}(e.customer,e.customer_year,e.currency_type):null,s=[{name:e.dashboard_metric?"Revenue":"Quantity",data:null===r?[]:r}];return t.series=s,t.options.yaxis.title.text=e.dashboard_metric?"Customer Revenue":"Customer Quantity",t};var k=(0,d.$j)((function(e){return{}}),{})(A),N=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,n.Z)(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={year:e.props.customer_year},e.handleYearChange=function(){var t=(0,s.Z)(u().mark((function t(r){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.UPDATE_CUSTOMER_YEAR_ACTION(r);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return(0,i.Z)(r,[{key:"render",value:function(){var e=this;return(0,C.jsx)("div",{className:"pie-select",children:(0,C.jsxs)(p.Z.Group,{className:"mb-4 pie-select__child",controlId:"exampleForm.ControlInput1",children:[(0,C.jsx)(p.Z.Label,{children:"Year"}),(0,C.jsxs)(p.Z.Select,{"aria-label":"Default select example",size:"sm",onChange:function(t){return e.handleYearChange(t.target.value)},children:[(0,C.jsx)("option",{children:this.state.year}),[2022,2021].map((function(t,r){return parseInt(e.state.year)===t?null:(0,C.jsx)("option",{value:t,children:t},r)}))]})]})})}}]),r}(l.Component);N.getDerivedStateFromProps=function(e,t){return t.year=parseInt(e.customer_year),t};var E={UPDATE_CUSTOMER_YEAR_ACTION:y.md},M=(0,d.$j)((function(e){return{customer_year:e.update_reducer.customer_year}}),E)(N),w=r(4794),I=r(8665),O=function(e,t){return e=e.filter((function(e){return e.customer.name===t.name}))},R=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,n.Z)(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={redirect:!1,spinner:!1,customer_spinner:!1,didnt_load:!1,customer_list:e.props.customer_list?e.props.customer_list:[],customer:e.props.customer_list?e.props.customer_list[0]:null,customer_name:null,customer_id:null,dashboard_metric:e.props.dashboard_metric,currency_type:e.props.currency_type,customer_year:e.props.customer_year,sales:[]},e.onSearchChange=function(t){""===t||void 0===t||null===t?e.setState({customer_list:e.props.customer_list}):e.setState({customer_name:t})},e.onSearch=function(t){t.preventDefault();var r=e.state.customer_name,s=e.props.customer_list;s=s.filter((function(e){return e.name.toLowerCase().includes(r.toLowerCase())})),e.setState({customer_list:s})},e.onClick=function(){var t=(0,s.Z)(u().mark((function t(r){var s;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((s=(s=e.state.customer_list).filter((function(e){return e.id===parseInt(r)}))).length>0)){t.next=7;break}return t.next=5,e.setState({customer_id:s[0].id,customer_spinner:!0});case 5:return t.next=7,e.props.GET_CUSTOMER_DETAIL_ACTION(s[0].id);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.componentDidMount=(0,s.Z)(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState({spinner:!0}),t.next=3,e.props.UPDATE_CUSTOMER_YEAR_ACTION((new Date).getFullYear());case 3:case"end":return t.stop()}}),t)}))),e}return(0,i.Z)(r,[{key:"render",value:function(){var e=this,t=this.state,r=t.spinner,s=t.customer_year,n=null;try{n=this.state.dashboard_metric?this.state.customer.revenue:this.state.customer.quantity}catch(i){}return this.state.redirect?(0,C.jsx)(v.Fg,{to:"/login"}):(0,C.jsxs)(x.Z,{header_title:"CUSTOMERS",children:[r||void 0===this.props.customer_list||void 0===this.props.customer_detail?(0,C.jsx)(S.Z,{spinner:r}):null,void 0!==this.props.customer_list?(0,C.jsxs)("div",{children:[(0,C.jsx)("div",{children:(0,C.jsx)(M,{})}),(0,C.jsxs)(m.Z,{children:[(0,C.jsx)(h.Z,{xs:3,children:(0,C.jsxs)("div",{className:"customer-side chart-area",children:[(0,C.jsx)("h6",{children:"Pick a customer"}),(0,C.jsxs)(p.Z,{className:"d-flex",onSubmit:this.onSearch,children:[(0,C.jsx)(_.Z,{type:"search",placeholder:"Search",className:"me-2","aria-label":"Search",size:"sm",onChange:function(t){return e.onSearchChange(t.target.value)}}),(0,C.jsx)(f.Z,{type:"submit",variant:"outline-primary",size:"sm",children:"Search"})]}),(0,C.jsx)("div",{children:this.state.customer_list.map((function(t,r){return(0,C.jsx)("div",{className:"customer-side__scroll",children:e.state.customer_id===t.id?(0,C.jsx)(f.Z,{className:"customer-side__customer customer-side__active",variant:"transparent",onClick:function(){return e.onClick(t.id)},children:(0,C.jsxs)("div",{className:"customer-side__info",children:[(0,C.jsx)("div",{className:"customer-side__profile"}),(0,C.jsx)("div",{children:(0,C.jsx)("h6",{className:"customer-side__name",children:t.name})})]})}):(0,C.jsx)(f.Z,{className:"customer-side__customer",variant:"transparent",onClick:function(){return e.onClick(t.id)},children:(0,C.jsxs)("div",{className:"customer-side__info",children:[(0,C.jsx)("div",{className:"customer-side__profile"}),(0,C.jsx)("div",{children:(0,C.jsx)("h6",{className:"customer-side__name",children:t.name})})]})})},r)}))})]})}),(0,C.jsx)(h.Z,{xs:9,style:{position:"relative"},children:this.state.customer_spinner||void 0===n?(0,C.jsx)(S.Z,{spinner:this.state.customer_spinner}):(0,C.jsxs)("div",{children:[(0,C.jsx)(b,{customer:n,name:this.state.customer?this.state.customer.name:null,customer_year:s}),(0,C.jsx)(k,{customer:n,customer_year:s,dashboard_metric:this.state.dashboard_metric,currency_type:this.state.currency_type}),(0,C.jsxs)("div",{children:[(0,C.jsx)(w.Z,{}),(0,C.jsx)(I.Z,{sales_list:this.state.sales,from_customer:!0})]})]})})]})]}):null]})}}]),r}(l.Component);R.getDerivedStateFromProps=function(){var e=(0,s.Z)(u().mark((function e(t,r){var s,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.token,n=t.customer_list,i=t.customer_detail,void 0!==s&&""!==s){e.next=6;break}return r.redirect=!0,e.abrupt("return",r);case 6:if(null!==r.customer_id&&void 0!==i){e.next=14;break}return r.customer_id=n[0].id,r.spinner=!1,r.customer_spinner=!0,e.next=12,t.GET_CUSTOMER_DETAIL_ACTION(n[0].id);case 12:e.next=15;break;case 14:void 0!==i&&r.customer_id==i.id?(r.customer=i,r.sales=O(t.sales,i),r.customer_spinner=!1,r.spinner=!1):void 0!==i&&r.customer_id!==i.id?r.customer_spinner=!0:(r.spinner=!1,r.customer_spinner=!1,r.customer_id=t.customer_detail.id);case 15:return r.customer_list=n,r.dashboard_metric=t.dashboard_metric,r.currency_type=t.currency_type,r.customer_year=t.customer_year,e.abrupt("return",r);case 20:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();var D={GET_CUSTOMER_LIST_ACTION:y.lM,GET_CUSTOMER_DETAIL_ACTION:y.w5,UPDATE_CUSTOMER_YEAR_ACTION:y.md},U=(0,d.$j)((function(e){return{token:e.auth_reducer.token,customer_list:e.list_reducer.customer_list,customer_detail:e.list_reducer.customer_detail,dashboard_metric:e.update_reducer.dashboard_metric,currency_type:e.update_reducer.currency_type,customer_year:e.update_reducer.customer_year,sales:e.list_reducer.sales_list}}),D)(R)},3847:function(e,t,r){r.d(t,{$G:function(){return i},P:function(){return n},zI:function(){return s}});var s=function(e,t){return e.setMonth(e.getMonth()+t),e},n=function(e){return"Million"===e?"m":"k"},i=function(e){return parseFloat(e.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0])}}}]);
//# sourceMappingURL=724.a9696ef2.chunk.js.map